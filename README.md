# smallblocks

Общая концепция архитектуры: “Изолированные микроцепи + Шардированный Message Bus + Глобальный PoS”

Идея

Система представляет собой модульную распределённую сеть, в которой каждый проект существует в полностью изолированной среде — в виде собственной независимой микроцепи (local chain). Эти микроцепи не делят общего состояния и не влияют друг на друга. При этом все они подключены к общей синхронизированной коммуникационной сети, реализованной как шардированный высокопроизводительный Message Bus, который обеспечивает надёжный обмен сообщениями между проектами. Message Bus при этом можно представить как файл F_{a,b}, который создаётся для двух local chain, в случае с этим F, это a и b. При этом изоляция блокчейнов достигается за счёт того, что они существуют отдельно от остальных, видя только a,b,F , однако область видимости может вырасти до c,d,e, если несколько блокчейнов связаны. В таком случае на каждую сеть может быть N соединений с остальными локальными цепями, а общее количество соединений между ними будет N * (N - 1) / 2, так как в теории можно соединить все со всеми. Для того чтобы рост количества соединений был не O(N ^ 2) можно ограничиться только N соединениями максимум с основным каналом через мультиплексирование трафика. В таком случае возникает проблема роста количества соединений O(N). Что может значительно увеличить нагрузку на сеть с большим количеством цепей так как они будут держать соединения. 

Далее для простоты я буду называть local chain, LC. LC1 при включении держит соединение с k узлами общего транспорта на некоторых узлах N1,N2,N3,...,Nk. При этом LC2 держит аналогичные соединения на некоторых узлах H1,H2,H3,...,Hk. Любое взаимодействие между ними будет проходить через маршрутизацию между узлами H1 в Nk или наоборот. Узлы которые будут держать сообщения выбираются исходя из оптимальной стратегии согласно оставшемуся месту, но на каком-то узле. Оставляя буфер под соединения между узлами. Таким образом ведётся маршрутизация между узлами. Это приводит к тому, что количество соединений просто разбивается на количество шардов O(N / n_shards), делая количество возможных сетей зависимым от количества узлов в сети.

Основной проблемой маршрутизации остаётся определение местоположения шардов. Для этого использутся концепция Token Ring, где LC_id выставлен как 512 или 1024 бит, при такой концепции поиск нужного узла маршрутизации просто будет сводиться к кэшированию информации с серверов мета данных, которые можно хранить на отдельных узлах мета информации сети, на узлах с консенсусом. При этом так как это работает автономно (должно по идее и поддерживает консунсус через PoS на этих узлах)

Компакция LC. LС никогда не изменяет состояния внутри, оно только эволюционирует, тем самым создавая новую LC. Размер существующей LC должен ограничиваться неким S_{LC}, в пределах которого оно работает, для экономии памяти. Остальная часть истории должна уходить в историю для дальнейшего возможного создания нового LC или можно назвать его форком.

Конфликты. В подобной сети нет конфликтов, из-за того что даже если значение было изменено, то это новое значение и отдельный независимый блок, который может общаться с другим таким же блоком, хотя они были созданы от одного блока через разделение из прошлого. Выходит что конфликтов в подобной системе быть не может, так как каждый новый блок полностью независим от старых блоков.


1. Изолированные микроцепи

Каждый проект — это отдельная цепочка исполнения (execution chain) со следующими свойствами:

полностью независимое состояние, история и логика;
переписываемая история допускается, так как правки затрагивают только эту цепь, а не всю сеть;
ошибки, откаты, форки и изменения консенсуса локализованы на уровне одной цепи и не влияют на остальные;
каждая микроцепь может иметь собственный алгоритм исполнения или даже собственный локальный механизм консенсуса.

2. Глобальная коммуникация через шардированный Message Bus

Все взаимодействия между микроцепями происходят не напрямую, а через Message Bus уровня L1, который:

распределён по нескольким шардам;

обеспечивает масштабируемый, высоконагруженный обмен событиями;

гарантирует доставку, упорядочивание и маршрутизацию сообщений;

не хранит глобального состояния проектов, а только логи сообщений.

Message Bus выполняет роль центрального коммуникационного уровня, аналогично “общей сети синхронизации”, но без глобальной общей истории, благодаря шардированию и независимости цепей.

3. Глобальный слой финальности на основе PoS

Поверх Message Bus работает слой глобального консенсуса:

единый набор валидаторов (Proof-of-Stake) подписывает, подтверждает и финализирует сообщения;

безопасность всей сети сосредоточена в одном PoS-слое, а не в каждой микроцепи;

валидаторы контролируют корректность сообщений, порядок доставки и поведение шарда Bus;

недобросовестные ноды могут быть наказаны (“slashing”).

PoS в этой архитектуре не защищает каждую микроцепь — он защищает глобальный Message Bus как центральный слой коммуникации, что значительно упрощает систему и увеличивает её масштабируемость.

4. Отсутствие глобальных форков

Так как в архитектуре нет линейной глобальной цепи, нет и глобальных форков:

история каждой микроцепи изолирована и может изменяться только локально;

любые ошибки, откаты или инциденты внутри одного проекта не затрагивают другие проекты;

сообщение считается финализированным только после подтверждения PoS-слоем, а локальные изменения в цепи проекта не могут нарушить глобальный порядок сообщений.

Таким образом сеть сохраняет целостность даже при локальных форках отдельных проектов.

5. Масштабируемость и производительность

Благодаря модульным компонентам:

микроцепей может быть сколько угодно — каждая работает автономно;

Message Bus состоит из множества шардов, масштабируемых горизонтально;

PoS-валидаторы обеспечивают финальность независимо от нагрузки в цепях;

архитектура выдерживает большие объёмы сообщений и множество параллельных проектов.

Это даёт возможность строить экосистему с очень высокой пропускной способностью и практически бесконечной масштабируемостью.